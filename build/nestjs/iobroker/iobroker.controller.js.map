{
  "version": 3,
  "sources": ["../../../src/nestjs/iobroker/iobroker.controller.ts"],
  "sourcesContent": ["import { BadRequestException, Body, Controller, Get, Post, Query, UsePipes } from '@nestjs/common';\nimport { DEFAULT_TIMEOUT } from '../main';\nimport { ValidationPipe } from '../validation.pipe';\nimport { Result } from './interfaces/result.interface';\nimport { AllInstanceService, GetAllInstanceNames_DTO } from './services/all-instances.service';\nimport { ControlAdapterService, ControlAdapter_DTO } from './services/control-adapter-service';\nimport { MIIOService, MIIO_DTO } from './services/miio-service';\nimport {\n    SearchAllTypesWithNamePatternIncludesBatch_DTO,\n    SearchAllTypesWithNamePatternIncludes_DTO,\n    SearchObjectService,\n} from './services/search-object.service';\nimport { SendToService, SendTo_DTO } from './services/send-to.service';\nimport {\n    AddURLNotification_DTO,\n    DeleteURLNotification_DTO,\n    URLNotificationSubscriptionService,\n} from './services/url-notification-subscription-service';\n\n@Controller('iobroker')\nexport class IobrokerController {\n    constructor(\n        private allInstanceServise: AllInstanceService,\n        private searchObjectService: SearchObjectService,\n        private sendToService: SendToService,\n        private mIIOService: MIIOService,\n        private urlNotificationSubscriptionService: URLNotificationSubscriptionService,\n        private controlAdapterService: ControlAdapterService,\n    ) {\n        this.allInstanceServise = new AllInstanceService();\n        this.searchObjectService = new SearchObjectService();\n        this.mIIOService = new MIIOService();\n        this.urlNotificationSubscriptionService = new URLNotificationSubscriptionService();\n        this.controlAdapterService = new ControlAdapterService();\n    }\n\n    @Get('allInstanceNames')\n    @UsePipes(new ValidationPipe({ meta: GetAllInstanceNames_DTO }))\n    async getAllInstanceNames(@Query() { timeout = DEFAULT_TIMEOUT }: GetAllInstanceNames_DTO): Promise<Result> {\n        console.log('==== Start getAllInstanceNames 1 ====');\n        return this.allInstanceServise.getAllInstanceNames({ timeout });\n    }\n\n    @Get('searchAllTypesWithNamePatternIncludes')\n    @UsePipes(new ValidationPipe({ meta: SearchAllTypesWithNamePatternIncludes_DTO }))\n    async searchAllTypesWithNamePatternIncludes(\n        @Query() { type, pattern, timeout = DEFAULT_TIMEOUT, path = '*' }: SearchAllTypesWithNamePatternIncludes_DTO,\n    ): Promise<Result> {\n        return this.searchObjectService.searchAllTypesWithNamePatternIncludes({ type, pattern, timeout, path });\n    }\n\n    @Post('searchAllTypesWithNamePatternIncludesBatch')\n    @UsePipes(new ValidationPipe({ meta: SearchAllTypesWithNamePatternIncludesBatch_DTO }))\n    async searchAllTypesWithNamePatternIncludesBatch(\n        @Body() { batch, timeout = DEFAULT_TIMEOUT }: SearchAllTypesWithNamePatternIncludesBatch_DTO,\n    ): Promise<Result> {\n        return this.searchObjectService.searchAllTypesWithNamePatternIncludesBatch({ batch, timeout });\n    }\n\n    @Post('sendTo')\n    public async sendTo(\n        @Body() { instance, command, message = {}, timeout = DEFAULT_TIMEOUT }: SendTo_DTO,\n    ): Promise<Result> {\n        return this.sendToService.sendTo({ instance, command, message, timeout });\n    }\n\n    /**\n     * stop/start/restart an IoB adapter\n     * @param {Command, adapterName, instance}\n     */\n    @Post('controlAdapter')\n    public async controlAdapter(@Body() props: ControlAdapter_DTO): Promise<Result> {\n        return this.controlAdapterService.controlAdapter(props);\n    }\n\n    @Post('miioGetSimpleMappingPost')\n    public async miioGetSimpleMappingPost(\n        @Body() { login, password, country, timeout = DEFAULT_TIMEOUT }: MIIO_DTO,\n    ): Promise<Result> {\n        return this.mIIOService.getSimpleMapping({ login, password, country, timeout });\n    }\n\n    @Get('miioGetSimpleMappingGet')\n    public async miioGetSimpleMappingGet(): Promise<any> {\n        return this.mIIOService.getSimpleMappingAll();\n    }\n\n    /**\n     * add a state to subscribe.\n     * if this state will change, the given urls will be called with the new state object\n     * @param {stateID, urls, timeout, forceOverwritte}:AddURLNotification_DTO\n     * @returns Result Promise with {result: _URL_SUBSCRIPTION {}}\n     */\n    @Post('addURLNotificationSubscription')\n    public async addURLNotificationSubscription(\n        @Body() { stateID, urls, timeout = DEFAULT_TIMEOUT, forceOverwritte = false }: AddURLNotification_DTO,\n    ): Promise<Result> {\n        // check if parameters are ok\n        if (!stateID) throw new BadRequestException('stateID musst be set');\n        if (!(Array.isArray(urls) && urls.length > 0 && urls.every((url) => typeof url == 'string')))\n            throw new BadRequestException('urls must be an Array of Strings');\n        // check if valid URL'\n        for (const url of urls) {\n            let returnFalse = false;\n            try {\n                returnFalse = !Boolean(new URL(url));\n            } catch (error) {\n                returnFalse = true;\n            }\n            if (returnFalse) throw new BadRequestException(`the URL ${url} are not valid`);\n        }\n\n        return this.urlNotificationSubscriptionService.addURLNotificationSubscription({\n            stateID,\n            urls,\n            timeout,\n            forceOverwritte,\n        });\n    }\n\n    /**\n     * get list with stateID's and the URL's\n     * @returns Result with {result:_URL_SUBSCRIPTION {}}\n     */\n    @Get('getURLNotificationSubscriptionList')\n    public getURLNotificationSubscriptionList(): Result {\n        return this.urlNotificationSubscriptionService.getURLNotificationSubscriptionList();\n    }\n\n    /**\n     * delete all the URLNotificationSubscriptions\n     * @returns Result Promise with {result: _URL_SUBSCRIPTION {}}\n     */\n    @Get('deleteAllURLNotificationSubscriptions')\n    public async deleteAllURLNotificationSubscriptions(): Promise<Result> {\n        return this.urlNotificationSubscriptionService.deleteAllURLNotificationSubscriptions();\n    }\n\n    /**\n     * deletes specifics URLNotificationSubscription from the given stateID Array\n     * @returns Result with {result:_URL_SUBSCRIPTION {}}\n     */\n    @Post('deleteURLNotificationSubscriptions')\n    public async deleteURLNotificationSubscriptions(@Body() props: DeleteURLNotification_DTO[]): Promise<Result> {\n        return this.urlNotificationSubscriptionService.deleteURLNotificationSubscriptions(props);\n    }\n\n    /**\n     * add an array of states to subscribe.\n     * if this states will change, the given urls will be called with the new state object\n     * @param [{stateID, urls, timeout, forceOverwritte}]:AddURLNotification_DTO[]\n     * @returns Result Promise with {result: _URL_SUBSCRIPTION {}}\n     */\n    @Post('addURLNotificationSubscriptions')\n    public async addURLNotificationSubscriptions(@Body() configs: AddURLNotification_DTO[]): Promise<Result> {\n        // check if parameters are ok\n        for (const { stateID, urls } of configs) {\n            if (!stateID) throw new BadRequestException('stateID musst be set');\n            if (!(Array.isArray(urls) && urls.length > 0 && urls.every((url) => typeof url == 'string')))\n                throw new BadRequestException('urls must be an Array of Strings');\n            // check if valid URL'\n            for (const url of urls) {\n                let returnFalse = false;\n                try {\n                    returnFalse = !Boolean(new URL(url));\n                } catch (error) {\n                    returnFalse = true;\n                }\n                if (returnFalse) throw new BadRequestException(`the URL ${url} are not valid`);\n            }\n        }\n\n        const allAddURLNotificationSubscription: Promise<Result>[] = [];\n\n        for (const { stateID, urls, timeout = DEFAULT_TIMEOUT, forceOverwritte = false } of configs) {\n            allAddURLNotificationSubscription.push(\n                this.urlNotificationSubscriptionService.addURLNotificationSubscription({\n                    stateID,\n                    urls,\n                    timeout,\n                    forceOverwritte,\n                }),\n            );\n        }\n\n        await Promise.all(allAddURLNotificationSubscription);\n\n        return this.urlNotificationSubscriptionService.getURLNotificationSubscriptionList();\n    }\n}\n"],
  "mappings": "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",
  "names": []
}
